<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Lucky Envelope (Smooth)</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f3e5f5;
            --envelope-main: #4CAF50;
            --envelope-flap: #66BB6A;
            --envelope-shadow: #2E7D32;
            --letter-bg: #ffffff;
            --text-color: #444;
            --btn-color: #4CAF50;
            --anim-speed: 0.6s; /* T·ªëc ƒë·ªô chuy·ªÉn ƒë·ªông */
            --anim-easing: cubic-bezier(0.4, 0, 0.2, 1); /* ƒê∆∞·ªùng cong chuy·ªÉn ƒë·ªông m∆∞·ª£t */
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            flex-direction: column;
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .wrapper {
            position: relative;
            width: 300px;
            height: 200px;
            margin-bottom: 50px;
            perspective: 1000px; /* Th√™m chi·ªÅu s√¢u 3D */
        }

        .envelope {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--envelope-main);
            border-radius: 0 0 10px 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1;
        }

        /* --- LOGIC ƒê√É FIX M∆Ø·ª¢T --- */
.flap {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    border-left: 150px solid transparent;
    border-right: 150px solid transparent;
    border-top: 110px solid var(--envelope-flap);
    transform-origin: top;
    
    /* 1. Z-INDEX: */
    /* Khi ƒë√≥ng, n·∫Øp ph·∫£i n·∫±m tr√™n c√πng (tr√™n t√∫i v√† th∆∞) */
    z-index: 5; 
    
    /* 2. TR·∫†NG TH√ÅI TRANSFORM: */
    transform: rotateX(0deg);

    /* 3. TRANSITION (QUAN TR·ªåNG NH·∫§T):
       - Khi ƒë√≥ng l·∫°i (t·ª´ class .open b·ªã g·ª° b·ªè):
       - transform: Ch·ªù th∆∞ th·ª•t xu·ªëng (delay = anim-speed) r·ªìi m·ªõi ƒë√≥ng n·∫Øp.
       - z-index: ƒê·ªïi l·∫°i th√†nh 5 khi n·∫Øp quay v·ªÅ v·ªã tr√≠ 90 ƒë·ªô (delay = anim-speed + 1/2 anim-speed).
    */
    transition: 
        transform var(--anim-speed) var(--anim-easing) var(--anim-speed),
        z-index 0ms linear calc(var(--anim-speed) + var(--anim-speed) / 2);
}

/* TR·∫†NG TH√ÅI M·ªû (.open) */
.wrapper.open .flap {
    transform: rotateX(180deg);
    
    /* Khi m·ªü ra, n·∫Øp ph·∫£i n·∫±m d∆∞·ªõi c√πng ho·∫∑c sau l√° th∆∞ */
    z-index: 1; 

    /* TRANSITION L√öC M·ªû:
       - transform: M·ªü ngay l·∫≠p t·ª©c (delay 0s).
       - z-index: ƒê·ªïi th√†nh 1 ngay khi n·∫Øp vu√¥ng g√≥c 90 ƒë·ªô (t·ª©c l√† sau 1/2 th·ªùi gian ch·∫°y).
       => K·ªπ thu·∫≠t n√†y gi√∫p n·∫Øp kh√¥ng b·ªã "xuy√™n" qua t√∫i.
    */
    transition: 
        transform var(--anim-speed) var(--anim-easing) 0s,
        z-index 0ms linear calc(var(--anim-speed) / 2); 
}

        /* --- LOGIC C·∫¢I TI·∫æN CHO LETTER (L√Å TH∆Ø) --- */
        .letter {
            position: absolute;
            top: 5px;
            left: 15px;
            width: 270px;
            height: 180px;
            background: var(--letter-bg);
            border-radius: 5px;
            z-index: 3; /* N·∫±m gi·ªØa N·∫Øp (5) v√† T√∫i (4) - SAI, T√∫i ph·∫£i l√† 4, Th∆∞ l√† 3 ƒë·ªÉ n·∫±m trong t√∫i */
            padding: 20px;
            box-sizing: border-box;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            
            /* TR·∫†NG TH√ÅI ƒê√ìNG (M·∫∑c ƒë·ªãnh):
               - Th∆∞ t·ª•t xu·ªëng NGAY L·∫¨P T·ª®C ƒë·ªÉ nh∆∞·ªùng ch·ªó cho n·∫Øp ƒë√≥ng.
               - Delay = 0s
            */
            transform: translateY(0);
            transition: transform var(--anim-speed) var(--anim-easing) 0s;
        }

        /* TR·∫†NG TH√ÅI M·ªû (.open):
           - ƒê·ª£i n·∫Øp m·ªü xong (delay = anim-speed) r·ªìi m·ªõi tr·ªìi l√™n.
        */
        .wrapper.open .letter {
            transform: translateY(-100px);
            z-index: 3; /* Gi·ªØ nguy√™n z-index ƒë·ªÉ t·∫°o c·∫£m gi√°c tr·ªìi t·ª´ trong t√∫i ra */
            transition: transform var(--anim-speed) var(--anim-easing) var(--anim-speed);
        }

        .letter-text {
            font-family: 'Dancing Script', cursive;
            color: var(--text-color);
            font-size: 1.2rem;
            line-height: 1.4;
        }

        .heart-icon {
            color: #E91E63;
            font-size: 1.5rem;
            margin-top: 10px;
            animation: beat 1s infinite alternate;
        }

        @keyframes beat {
            to { transform: scale(1.1); }
        }

        /* T√öI ƒê·ª∞NG (POCKET) */
        .pocket {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid var(--envelope-main);
            border-right: 150px solid var(--envelope-shadow);
            border-top: 100px solid transparent;
            border-bottom: 100px solid var(--envelope-shadow);
            border-radius: 0 0 10px 10px;
            z-index: 4; /* Lu√¥n n·∫±m tr√™n l√° th∆∞ (z-index 3) ƒë·ªÉ che ph·∫ßn d∆∞·ªõi th∆∞ */
            pointer-events: none;
        }

        /* CONTROLS */
        .controls {
            margin-top: 80px;
            display: flex;
            gap: 20px;
            z-index: 10;
        }

        button {
            padding: 12px 35px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--btn-color);
            background: white;
            border: 2px solid var(--btn-color);
            border-radius: 30px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: var(--btn-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }

        button:active {
            transform: translateY(0);
        }

        /* PARTICLE ANIMATION */
        .clover {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            20% {
                opacity: 1;
                transform: translateY(-20px) rotate(45deg) scale(1);
            }
            100% {
                transform: translateY(-300px) rotate(360deg) scale(0.8);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <div class="wrapper" id="envelopeWrapper">
        <div class="envelope">
            <div class="flap"></div>
            
            <div class="letter">
                <div class="letter-text" contenteditable="true">
                    To 88 Girl,<br><br>
                    Can you play Aram with me tonight?.
                </div>
                <div class="heart-icon">üíö üçÄ üíö</div>
            </div>

            <div class="pocket"></div>
        </div>
    </div>

    <div class="controls">
        <button id="openBtn">Open</button>
        <button id="closeBtn">Close</button>
    </div>

    <script>
        const wrapper = document.getElementById('envelopeWrapper');
        const openBtn = document.getElementById('openBtn');
        const closeBtn = document.getElementById('closeBtn');
        const cloverSymbol = 'üçÄ';

        openBtn.addEventListener('click', () => {
            if (!wrapper.classList.contains('open')) {
                wrapper.classList.add('open');
                createClovers();
            }
        });

        closeBtn.addEventListener('click', () => {
            wrapper.classList.remove('open');
        });

        function createClovers() {
            // Ch·ªù m·ªôt ch√∫t cho n·∫Øp m·ªü ra r·ªìi m·ªõi b·∫Øn tim/c·ªè
            setTimeout(() => {
                const particleCount = 20;
                
                for (let i = 0; i < particleCount; i++) {
                    const clover = document.createElement('div');
                    clover.classList.add('clover');
                    clover.innerText = Math.random() > 0.5 ? 'üçÄ' : 'üíö'; // Random gi·ªØa c·ªè v√† tim
                    
                    document.body.appendChild(clover);

                    const rect = wrapper.getBoundingClientRect();
                    // Xu·∫•t ph√°t t·ª´ gi·ªØa phong b√¨
                    const startX = rect.left + rect.width / 2;
                    const startY = rect.top + rect.height / 2;

                    // Random v·ªã tr√≠ ngang
                    const randomX = (Math.random() - 0.5) * 200; 
                    
                    clover.style.left = `${startX + randomX}px`;
                    clover.style.top = `${startY}px`;
                    
                    const duration = 2 + Math.random() * 2;
                    const delay = Math.random() * 0.5; // Random delay ƒë·ªÉ kh√¥ng bay l√™n c√πng l√∫c
                    
                    clover.style.animation = `floatUp ${duration}s ease-out forwards ${delay}s`;

                    setTimeout(() => {
                        clover.remove();
                    }, (duration + delay) * 1000);
                }
            }, 500);
        }
    </script>
</body>
</html>